.\" Automatically generated by Pandoc 2.17.1.1
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "" "" "" "" ""
.hy
.SH Energia
.PP
Energia is a simple and configurable power manager for Linux.
A \f[I]power manager\f[R] is a tool which detects when your system is
idle, that is, when you\[cq]re not using your keyboard or mouse and
you\[cq]re not running any applications which prevent your system from
being idle (such as video players).
Once your system is idle, it runs a series of actions (called
\f[I]effects\f[R] in Energia) after configurable time has passed.
.SS Requirements and installation
.PP
Currently, your system must have these 3 components installed and in
use:
.IP \[bu] 2
\f[V]systemd\f[R] - used to put computer to sleep, change screen
brightness without being root, detect inhibitors (applications which
prevent your computer from going into an idle state or from sleeping)
and announce idleness and locking to the rest of the system.
.IP \[bu] 2
\f[V]X11\f[R] - the display server announces the idleness and handles
screen shutdowns
.IP \[bu] 2
\f[V]upower\f[R] - used to detect the system\[cq]s power source and
battery percentage
.PP
Since Energia has a highly modular codebase, most of these can be
replaced or adapted (to use e.g.\ Wayland or phase out \f[V]upower\f[R])
by anyone who is at least a bit skilled in Rust.
MRs are welcome!
.PP
You may find that you want two more things to be installed:
.IP \[bu] 2
A \f[I]locker\f[R] which can be invoked as a CLI command (such as
i3lock (https://github.com/i3/i3lock)) is necessary to use the screen
locking functionality in Energia.
This is not integrated, since different people may want to use different
lockers to suit their needs and aesthetic preferences.
.IP \[bu] 2
An application which can handle power saving settings configuration,
such as TLP (https://linrunner.de/tlp/).
Because TLP is, as they say themselves and our experience confirms, an
\[lq]install and forget\[rq] kind of application, we have decided not to
duplicate their work and instead recommend this wonderful package.
.PP
For now, Energia is not distributed as a package.
Since it\[cq]s written in Rust, you can compile it yourself with a
simple \f[V]cargo build\f[R] command and then plop it down on your
system.
.PP
For more information about installing a Rust toolchain, please refer to
their documentation (https://www.rust-lang.org/learn/get-started).
Energia or its dependencies don\[cq]t use unstable Rust features, so
installing a stable toolchain is sufficient.
.PP
If you can\[cq]t be bothered to clone this repository, you can use
\f[V]cargo install\f[R]:
.IP
.nf
\f[C]
cargo install --git=https://github.com/selverob/energia # Install from the master branch
cargo install --git=https://github.com/selverob/energia --tag v0.1.0 # Install the lastest stable version
\f[R]
.fi
.PP
This will compile Energia and install it to
\f[V]\[ti]/.cargo/bin/energia\f[R].
.SS Starting Energia
.PP
Due to some architectural limitations, Energia needs to run
\f[I]within\f[R] a user\[cq]s logind session.
Due to that, you can\[cq]t run Energia as a systemd unit.
You should start Energia the way you start any other applications which
need to run after the start of your display server / window manager.
.PP
For example, if you\[cq]re using i3 as your window manager, you can put
this into your config:
.IP
.nf
\f[C]
exec --no-startup-id energia
\f[R]
.fi
.SS Glossary
.PP
Before we get into the details of configuration, we need to define some
terms which are used in the rest of the documentation:
.IP \[bu] 2
\f[B]Effect\f[R] is an action that Energia performs on your system.
An example would be dimming the screen, locking your computer or putting
it to sleep.
Effects are executed at a time defined by the schedule and most are
rolled back once you wake your system (for example by moving your mouse
or pressing a key).
Some effects are obviously not rolled back automatically, such as system
locking (since you probably don\[cq]t want to unlock your computer by
pressing any key) or sleep (\[lq]rollback\[rq] of that is handled by
your PC).
.IP \[bu] 2
\f[B]Effector\f[R] is a module which provides effects.
It can provide a single effect or multiple effects which have to be
executed sequentially.
All effects from an effector share a configuration section.
.IP \[bu] 2
\f[B]Schedule\f[R] specifies the periods of idleness after which certain
effects are performed.
You can for example say that you want to dim the screen after 3 minutes
and turn it off after 10 minutes of inactivity.
Energia will then wait until 3 minutes have passed since you\[cq]ve last
interacted with your computer and if no application will be inhibiting
system idleness, it will dim the screen.
If you don\[cq]t interact with your computer for further 7 minutes, it
will turn the screen off.
.SS Anatomy of a configuration file
.PP
Energia\[cq]s configuration is written in TOML (https://toml.io) and at
the minimum, must contain at least one schedule and configurations
required for effectors which provide effects used in your schedules.
.PP
An example configuration file would look like this:
.IP
.nf
\f[C]
# Schedule to follow when the PC is running with an external power source
[schedule.external]
# After 3 minutes of inactivity, the screen will dim
# and the system will be locked
screen_dim  = \[dq]3m\[dq]
lock        = \[dq]3m\[dq]
# After further 30 seconds, the screen will be turned off
screen_off  = \[dq]3m 30s\[dq]
# And once the computer has been idle for 10 minutes 
#(i.e. 6:30 minutes after the screen gets turned off),
# it will be put to sleep
sleep       = \[dq]10m\[dq]

# Schedule to follow when the PC is running on battery
[schedule.battery]
lock        = \[dq]5m\[dq]
screen_dim  = \[dq]10m\[dq]
screen_off  = \[dq]15m\[dq]

# When you\[aq]re running out of battery, you may want Energia to be more aggressive
[schedule.low_battery]
screen_dim  = \[dq]1m\[dq]
sleep       = \[dq]5m\[dq]

[battery]
# Battery percentage at which the low_battery schedule will apply.
# If not set, low battery schedule will never be used.
low_battery_percentage = 20

# Configuration for lock effector
[lock]
command = \[dq]i3lock\[dq]
args = [\[dq]-n\[dq]] # Ensure i3lock will not fork, thus allowing Energia to know whether it should start a new locker or not.
\f[R]
.fi
.PP
The times in the schedules are specified as \f[B]absolute\f[R] times
within the idleness period.
.SS Runtime configuration
.PP
There are three flags that can be used to control Energia\[cq]s
behavior:
.IP \[bu] 2
\f[V]-c, --config-file <CONFIG_FILE>\f[R] which sets the path to the
configuration file described above.
By default, Energia will load config from
\f[V]\[ti]/.config/energia/config.toml\f[R].
.IP \[bu] 2
\f[V]-l, --log-level <LOG_LEVEL>\f[R] which sets the log verbosity.
Available levels are \f[V]error\f[R], \f[V]warn\f[R], \f[V]info\f[R],
\f[V]debug\f[R] and \f[V]trace\f[R].
Now during development, the default value is \f[V]debug\f[R].
Additional logging specification options can be found in
\f[V]flexi_logger\f[R]\[cq]s
docs (https://docs.rs/flexi_logger/latest/flexi_logger/struct.LogSpecification.html).
.IP \[bu] 2
\f[V]--log-directory <LOG_DIRECTORY>\f[R] which sets the directory into
which the logs should be written.
By default, this is set to \f[V]\[ti]/.config/energia/log/\f[R].
.SS A list of effectors, provided effects and configurations
.IP \[bu] 2
\f[B]brightness\f[R] effector
.RS 2
.IP \[bu] 2
Provided effects:
.RS 2
.IP \[bu] 2
\f[V]screen_dim\f[R] - dim the screen to 50% of its current brightness.
.RE
.IP \[bu] 2
Configuration:
.RS 2
.IP \[bu] 2
\f[V]dim_percentage\f[R] (integer, default: 50) - the percentage to
which the brightness should be reduced relative to the current
brightness.
.RE
.RE
.IP \[bu] 2
\f[B]dpms\f[R] effector
.RS 2
.IP \[bu] 2
Provided effects:
.RS 2
.IP \[bu] 2
\f[V]screen_off\f[R] - turn all the screens connected to the computer
off.
.RE
.IP \[bu] 2
Configuration:
.RS 2
.IP \[bu] 2
N/A
.RE
.RE
.IP \[bu] 2
\f[B]lock\f[R] effector
.RS 2
.IP \[bu] 2
Provided effects:
.RS 2
.IP \[bu] 2
\f[V]lock\f[R] - start a screen locking application and set
\f[V]LockedHint\f[R] on user\[cq]s \f[V]logind\f[R] session to
\f[V]true\f[R].
Never rolled back automatically.
.RE
.IP \[bu] 2
Configuration:
.RS 2
.IP \[bu] 2
\f[V]command\f[R] (string, required) - the path to the locker to
execute.
.IP \[bu] 2
\f[V]args\f[R] (list of strings, required) - arguments to be passed to
the locker.
.RE
.IP \[bu] 2
If configuring this effector will cause additional features to be
enabled, see below.
.RE
.IP \[bu] 2
\f[B]sleep\f[R] effector
.RS 2
.IP \[bu] 2
Provided effects:
.RS 2
.IP \[bu] 2
\f[V]sleep\f[R] - put the computer to sleep as if by calling
\f[V]systemd suspend\f[R] on the command line.
.RE
.IP \[bu] 2
Configuration:
.RS 2
.IP \[bu] 2
N/A
.RE
.RE
.IP \[bu] 2
\f[B]session\f[R] effector
.RS 2
.IP \[bu] 2
Provided effects:
.RS 2
.IP \[bu] 2
\f[V]idle_hint\f[R] - set the \f[V]IdleHint\f[R] property on user\[cq]s
\f[V]logind\f[R] session to \f[V]true\f[R].
This effect is only mentioned for completeness.
Energia automatically executes it with the first real effect specified
in the schedule.
.RE
.IP \[bu] 2
Configuration:
.RS 2
.IP \[bu] 2
N/A
.RE
.RE
.SS Additional locking behavior
.PP
If you configure the lock effector, two additional features will be
enabled, even if \f[V]lock\f[R] action is not in any schedule:
.IP \[bu] 2
\f[B]Automatic locking on sleep\f[R] - When Energia detects that your
computer is going to sleep, it will invoke the locker.
.IP \[bu] 2
\f[B]D-Bus lock invocation API\f[R] - You can lock your computer by
sending a Lock message on session/user D-Bus.
The service is \f[V]org.energia.Manager\f[R], path is
\f[V]/org/energia/Manager\f[R] and the interface is
\f[V]org.energia.Manager\f[R].
.RS 2
.PP
This can be used in conjunction with \f[V]busctl\f[R] to allow
hotkey-triggered locking.
For example, if you want to lock your session with a Modifier+Shift+L
hotkey in i3, you can add the following to your i3 config:
.IP
.nf
\f[C]
bindsym $mod+Shift+l exec busctl --user call org.energia.Manager /org/energia/Manager org.energia.Manager Lock
\f[R]
.fi
.RE
.PP
Copyright (C) 2022 R\['o]bert Selvek
.PP
This program is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your
option) any later version.
.PP
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
See the GNU General Public License for more details.
.PP
You should have received a copy of the GNU General Public License along
with this program.
If not, see <https://www.gnu.org/licenses/>.
